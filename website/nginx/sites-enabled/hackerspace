upstream myapp_prod {
   server website:8000 fail_timeout=0;
}

server {

    listen 80;
    server_name _;
    charset utf-8;

    location "/.well-known/acme-challenge" {
        default_type "text/plain";
        root /tmp/letsencrypt-auto;
    }

    location / {
        return 301 https://$host$request_uri;    
}

}

server {
        listen 443 ssl;
        add_header Strict-Transport-Security "max-age=1800; includeSubdomains; preload";
        server_name hackerspace-ntnu.no www.hackerspace-ntnu.no hackerspace.idi.ntnu.no;
        ssl_certificate /etc/letsencrypt/live/hackerspace-ntnu.no/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/hackerspace-ntnu.no/privkey.pem;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers HIGH:!aNULL:!MD5;

        #root /var/www/html/;
        index index.php index.html;
         charset UTF-8;

    location /static {
        alias /code/static;
    }
    location /media {
        alias /code/media;
    }

        location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        if (!-f $request_filename) {
            proxy_pass http://myapp_prod;
            break;
        }
    }
}
